# Journal Entry 002 - 2026-02-12 - Migrate to go-eventkit

## Goal
Replace `internal/eventkit/` (custom cgo+ObjC EventKit bridge) and AppleScript-based writes with `github.com/BRO3886/go-eventkit` — a standalone library extracted from rem that supports both reads AND writes via EventKit.

## What Changed
- **Deleted `internal/eventkit/`** — 4 files (~400 lines of cgo+ObjC): `eventkit_darwin.m`, `eventkit_darwin.h`, `eventkit.go`, `eventkit_other.go`
- **Renamed `internal/applescript/` → `internal/service/`** — package no longer primarily about AppleScript
- **Rewrote `internal/service/reminders.go`** — `ReminderService` now wraps `*reminders.Client` from go-eventkit. All CRUD (create, get, list, update, delete, complete/uncomplete) goes through EventKit. Only flagged operations still use AppleScript.
- **Rewrote `internal/service/lists.go`** — `ListService` wraps `*reminders.Client` for reads, keeps AppleScript for create/rename/delete (go-eventkit doesn't support list CRUD)
- **Updated `cmd/rem/commands/root.go`** — `reminders.New()` returns `(*Client, error)`, handled with `os.Exit(1)` on failure
- **Updated `pkg/client/client.go`** — `New()` now returns `(*Client, error)` (breaking API change). Uses go-eventkit internally.
- **Updated `pkg/client/client_other.go`** — Matching `New()` signature
- **Added tests**: `internal/service/reminders_test.go`, `internal/service/lists_test.go`, `pkg/client/client_test.go`
- **Updated all docs**: CLAUDE.md, README.md, MEMORY.md, website architecture/api/performance pages

## Key Insights
- **Field name mapping is the main complexity**: go-eventkit uses `Title`/`Notes`/`List`/`CreatedAt`/`ModifiedAt` while rem's internal model uses `Name`/`Body`/`ListName`/`CreationDate`/`ModificationDate`. The `fromEventKitReminder()` conversion function handles this.
- **URL backwards compat**: go-eventkit has a native `URL` field. Old reminders may still have URLs stored in notes with `URL: ` prefix. `fromEventKitReminder` checks both — native URL takes precedence, falls back to notes extraction.
- **Flagged is still broken in EventKit**: `EKReminder.flagged` is not exposed. JXA fallback for `--flagged` filter remains. AppleScript for flag/unflag writes remains. This is an Apple limitation.
- **go-eventkit's `CreateReminder` returns the created reminder** (with ID), while AppleScript just returned the ID string. Adapted `CreateReminder` to extract `.ID` from the returned reminder.
- **`UpdateReminder` split path**: Most fields go through go-eventkit's `UpdateReminderInput`. Flagged goes through AppleScript. The service layer handles this transparently.
- **`client.New()` is now fallible**: This is a breaking change for `pkg/client` consumers. Was `New() *Client`, now `New() (*Client, error)`. Necessary because `reminders.New()` can fail with `ErrAccessDenied` or `ErrUnsupported`.

## Decisions Made
- **Keep AppleScript executor** for list CRUD + flagged — minimal footprint (~130 lines), no cgo dependency
- **Renamed `internal/applescript` → `internal/service`** — better reflects its role as a service layer wrapping go-eventkit
- **go-eventkit local replace directive** for development: `replace github.com/BRO3886/go-eventkit => ../go-eventkit`
- **Breaking `pkg/client.New()` API** — returning error is correct. The old `panic` on non-darwin was worse.

---

## Session 2 - Migrate List CRUD to go-eventkit + Release v0.3.0

### Goal
Eliminate the last AppleScript CRUD dependency by migrating list create/rename/delete from AppleScript to go-eventkit v0.2.1's new list CRUD operations. Tag and release v0.3.0.

### What Changed
- **Rewrote `internal/service/lists.go`** — `CreateList`, `RenameList`, `DeleteList` now use go-eventkit's `client.CreateList()`, `client.UpdateList()`, `client.DeleteList()` instead of AppleScript
- **Added `findListByName`** helper — looks up go-eventkit `List` by name to get the ID needed for update/delete
- **Added `defaultSource`** helper — auto-discovers source (e.g. "iCloud") from existing lists for `CreateList`
- **Added immutability checks** — `RenameList` and `DeleteList` check `ReadOnly` flag before attempting operation
- **Bumped `go-eventkit` to v0.2.1** in `go.mod` (from v0.1.1)
- **Updated tests** — expanded `lists_test.go` with field mapping, zero count, and empty name validation tests
- **Updated all docs** — README, CLAUDE.md, MEMORY.md, website (architecture, api, performance), skills reference
- **No CLI command changes needed** — service layer preserved the same public API (`CreateList(name)`, `RenameList(old, new)`, `DeleteList(name)`)
- **Tagged v0.3.0** and created GitHub release with arm64 binary attached

### Key Insights
- **go-eventkit `CreateList` requires Source** — unlike AppleScript which picks a default. Solution: auto-discover from existing lists, fall back to "iCloud".
- **go-eventkit list ops are ID-based** — `UpdateList(id, input)` and `DeleteList(id)`. The service layer does name→ID resolution internally, keeping the CLI interface unchanged.
- **`ErrImmutable`** — new error type in go-eventkit v0.2.1 for system lists. Pre-checked via `ReadOnly` field for better error messages.
- **Executor still needed** — for flagged operations (JXA + AppleScript) and `GetDefaultListName()`. Can't fully remove yet.
- **No breaking API changes** — the `ListService` public methods kept the same signatures, so no CLI changes were needed.

### Decisions Made
- **Auto-discover source** rather than requiring it as a parameter — keeps CLI simple, matches user expectations
- **Pre-check immutability** with `ReadOnly` field rather than relying solely on `ErrImmutable` — provides clearer error messages with list name
- **v0.3.0 versioning** — feature release (not breaking), list CRUD migration is a significant feature improvement

---
