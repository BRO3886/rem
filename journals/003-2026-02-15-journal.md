# Journal Entry 003 - 2026-02-15 - Install script, website install section, CLAUDE.md updates

## Goal

Add a curl-pipe-bash install script for `rem`, serve it from `rem.sidv.dev/install`, and update the website homepage with a tabbed install section showing all three installation methods.

## What Changed

- **`scripts/install.sh`** — New install script that:
  - Detects macOS + arch (arm64/amd64)
  - Fetches latest release tag from GitHub API
  - Downloads the correct binary from releases
  - `chmod +x` + installs to `/usr/local/bin` (with sudo if needed)
  - Cleanup via `trap` on temp dir
- **`website/static/install`** — Copy of install script served by Hugo at `rem.sidv.dev/install`
  - Usage: `curl -fsSL https://rem.sidv.dev/install | bash`
- **Homepage install section** — Replaced 2-method layout with tabbed interface:
  - **Script** tab (default, recommended) — curl one-liner
  - **Go Install** tab — `go install` with Xcode CLT note
  - **Download** tab — manual download with `chmod +x` and `mv` steps
  - CSS: segmented control style tabs matching Apple aesthetic, `fadeIn` animation on panel switch
  - JS: Tab switching with ARIA attributes
- **`CLAUDE.md`** — Added "Website & Hosting" section documenting `rem.sidv.dev`, Cloudflare Pages, install script location
- **`.claude/commands/prep-for-task.md`** — Added rule to always read `CLAUDE.md` directly (not via subagent) before launching exploration agents

## Key Insights

- **Hugo `static/` dir** serves files directly at root — `website/static/install` becomes `rem.sidv.dev/install` with no redirect needed. Simpler than Cloudflare redirect rules or Workers.
- **GitHub release binaries lose execute permission** — downloaded binaries from releases don't have `+x`. The install script handles this with `chmod +x`, and the manual download tab explicitly shows the step.
- **Tabbed install UI** fits naturally into the existing design system — reuses `.install-card`, `.code-block`, `.install-label` patterns. The segmented control (`.install-tabs`) uses `var(--bg-secondary)` background with active tab getting `var(--bg-tertiary)` + subtle shadow.

## Decisions Made

- **Canonical script in `scripts/install.sh`**, copy in `website/static/install`** — two copies is a minor duplication tradeoff for having the script both in the repo root area (for GitHub browsing) and served by the site
- **Tabs over stacked cards** — three install methods stacked vertically with dividers would be too long; tabs keep it compact and let each method have its own notes/context
- **No Homebrew yet** — planned for next session; needs a tap repo and formula

---

## Session 2 - Tarball releases, make release target, v0.4.0

## Goal

Fix the execute permission issue on GitHub release binaries and ship v0.4.0.

## What Changed

- **`Makefile`** — Added `make release` target: builds arm64 binary, `chmod +x`, wraps in `.tar.gz`
- **Install script** — Updated to download `.tar.gz` and `tar xzf` instead of raw binary
- **Website manual download tab** — Updated to show tarball flow (no more `chmod +x` step)
- **`CLAUDE.md`** — Added Releasing section: always use `make release`, no CI (macOS runners too expensive)
- **Release workflow removed** — macOS GitHub Actions runners have 10x minute multiplier on free tier
- **v0.4.0 released** — `gh release create v0.4.0` with `rem-darwin-arm64.tar.gz`

## Key Insights

- **HTTP has no concept of file permissions** — `curl` always creates files with `644`. This isn't a GitHub issue, it's fundamental to HTTP downloads. Raw binary uploads will always lose `+x`.
- **`tar` preserves permissions** — tarball is the standard solution. `tar xzf` extracts with the original mode bits intact (`-rwxr-xr-x`).
- **macOS GitHub Actions runners** — 10x cost multiplier on free tier. For a macOS-only cgo binary, manual releases from local machine are the pragmatic choice.

## Decisions Made

- **Tarball over raw binary** — only reliable way to preserve `+x` across HTTP download
- **No CI release workflow** — macOS runner cost makes it impractical for free tier; `make release` + `gh release create` is simple enough
- **`make release` as the canonical build command** — documented in CLAUDE.md so future sessions use it

---

## Session 3 - amd64 release, README cleanup, overflow fix

## Goal

Add amd64 build to release target, update README to remove stale Go API references and add all install methods, fix website code block overflow.

## What Changed

- **`Makefile`** — `make release` now builds both arm64 and amd64 in a loop, producing two tarballs
- **README.md** — Rewrote Installation section with 4 methods (curl script, go install, manual tarball for both arches, build from source). Removed "Public Go API" references — `pkg/client/` was removed in go-eventkit migration; now points to go-eventkit directly.
- **v0.4.0 release** — Uploaded `rem-darwin-amd64.tar.gz` alongside existing arm64 tarball
- **Website CSS** — Added `overflow-x: auto` to `.code-block-multi` to fix long URLs overflowing the install card on the Download tab

## Key Insights

- **Stale API references persist** — after removing `pkg/client/`, the README tagline, features list, top links, and Go API section all still referenced it. Need to grep comprehensively when removing a public-facing feature.
- **`white-space: pre` + flex layout = overflow** — the multi-line code block used `pre` for formatting but the parent flex container didn't constrain width, so the long GitHub URL pushed content outside the card boundary.

## Decisions Made

- **Loop in Makefile over arches** — cleaner than duplicating build lines; `for arch in arm64 amd64` with `rm bin/rem` between builds to avoid stale binaries
- **Keep Go API section in README but reframe** — still useful to show go-eventkit usage example, just reworded to make clear it's a separate library, not rem's own API

---
